 
   <script>
   
   /**
   * Run initializations on load.
   */
 
$(function() {
    
    studentList();

});

$('#page3').hide();

$('#tasks').click(function() { $('#tasks').prop( "disabled", true ); $('.page2button').prop( "disabled", false ); checklist();});

$('#backhome').click(function() { $('#tasks').prop( "disabled", false ); returnHome();});

$('#userType').change(function() { $('#newStudentSubmit').prop( "disabled", false );});

$('#fabplus').click(function() { addUser() });

$('#close').click(function() { $('#page3').hide(500); });


function addUser() {

 $('.studentForm').empty();
 $('#page3').show(1000);

}


function studentList() {

    $('#newStudentSubmit, .page2button').prop( "disabled", true );
    $('#page2').hide();
    $('#page1').show(1000);
    $('#fabplus').prop( "disabled", false );
   
google.script.run
            .withSuccessHandler(function(students) {
            // Respond to success conditions here.
           
              createRadioboxes(students);
              $('#listofusers').show(1000);
          })
       .withFailureHandler(function(msg) {
            // Respond to failure conditions here.
            $('#listofusers').show();
             $('#listofusers').html(msg);
          })
            .findStudents(); 


}

function returnHome() {

    $('#newStudentSubmit, .page2button').prop( "disabled", true );
    $('#page2').hide();
    $('#page1').show(1000);
    $('#fabplus, #tasks').prop( "disabled", false );

}



//shows checklist of selected student
function checklist() {

 $('#page1, #page3').hide(1000);
 $('#fabplus').prop( "disabled", true );
 $('#output').empty();
 
  var student = $('input[type="radio"]:checked').val();
    
   google.script.run
            .withSuccessHandler(function(tasks) {
            // Respond to success conditions here.
           
              createCheckboxes(tasks);
              $('#page2').show(1000);
          })
       .withFailureHandler(function(msg) {
            // Respond to failure conditions here.
            $('#output').show();
             $('#output').html(msg);
          })
            .tasks(student); 
  
 }
 
 function createCheckboxes(tasks) {
 
 $('#studentName').html(tasks[0][0]); //student name
 $('#yearGroup').html(tasks[0][1]); //year group
 $('#enrollmentDate').html(tasks[0][2]); //year group
  
   var container = $('#output');
   var taskNumber = tasks.length;
   var id="";

 for (var f=2; f<taskNumber ; f++) {

  id = 'tasks'+f;
     $('<tr />',{id: 'row'+f}).appendTo(container);
     var row = $("#row"+f);
     var checkBox = $('<td />', { class:'checkboxRow' }).appendTo(row);
     $('<input />', { class:'taskDone', type: 'checkbox', id: id, value: tasks[f][0] }).appendTo(checkBox);
     if (tasks[f][1]) {$('#'+id).prop('checked',true);}; // if task has a username in next cell checked as done
     
     var taskdescrip = $('<td />', { class:'taskdescrip' }).appendTo(row);
     $('<input />', { class:'taskDesc taskdescriptions', 'for': id, type: 'text',value: tasks[f][0] }).appendTo(taskdescrip);
    
     var usernameResp = $('<td />', { class:'usernameResp' }).appendTo(row);
     $('<input />', { id: 'taskResps'+f, class:'taskResps', type: 'text', value: tasks[f][2] }).appendTo(usernameResp);
     
     $('<td />',{ id: 'username'+f, class:'username', html:tasks[f][1]}).appendTo(row);
     }

 }
 
 //adds username next to task when checkbox checked , or removes when unchecked
 
$( "#output" ).on( "click", "input.taskDone", function( event ) {

   

 var selector = $(this).parent().nextAll(".username"); //finds username element in line with clicked input
 
 var checkSelected = $(this).prop('checked');

if (checkSelected) { //if task checked add username of active user to end of task desc
 
 google.script.run
            .withSuccessHandler(function(user) {
            // Respond to success conditions here.
           selector.html(user);
          })
          .activeUser();
          
          }
          
 else { selector.empty();   }    //if unchecked, removes username  
 
});
 
// archives student by adding '*' to sheet name

  $('#archive').click(function() {
  
  $('#archive, #tasks').prop( "disabled", true );
  
  
  var student = $('#studentName').text();
  
  google.script.run
            .withSuccessHandler(function(success) {
            
           studentList() 
           confirm(success + " has been archived");
           returnHome();
            })
            .archiveStudent(student);
            
  });
 
//maps task list and usernames to array and sets as values in appropriate sheet 
 
  $('#update').click(function() {
  
  $('#update').prop( "disabled", true );
  
  
 var student = $('#studentName').text();
 
 

var tasks =[];
$('.taskdescriptions').each(function(index, obj)
{
  tasks.push($(this).val());
});

 var usernames =[];
$('.username').each(function(index, obj)
{
  usernames.push($(this).text());
});

 var responsibility = [];
$('.taskResps').each(function(index, obj)
{
  responsibility.push($(this).val());
});


$('input').remove('.taskDone');
var tasksHtml = $('table').html();


  google.script.run
            .withSuccessHandler(function(success) {
            // Respond to success conditions here.
             $('#update').prop( "disabled", false );
             $('#spinner').hide();
             confirm(success);
          })
       .withFailureHandler(function(msg) {
            // Respond to failure conditions here.
             $('#update').prop( "disabled", false );
             $('#spinner').hide();
             $('#updateResponse').show();
             $('#updateResponse').html(msg);
          })
            .tableToSpreadsheet(student,tasks,usernames,responsibility,tasksHtml)
    });
    
 $('#search').click(function() { 
    
    $('#students').show();
    $('#students').html('searching....');
    var searchterm= $("form input:text").val();
    
   google.script.run
            .withSuccessHandler(function(studentsFound) {
            // Respond to success conditions here.
            $('#students').show();
              createRadioboxes(studentsFound);
             
          })
       .withFailureHandler(function(msg) {
            // Respond to failure conditions here.
            $('#students').show();
             $('#students').html(msg);
          })
            .findStudents(searchterm) 
  
 });
 
 //list of sheets of students as radio boxes to select
 
 function createRadioboxes(studentsFound) {    
  
   var container = $('#listofusers');
   var taskNumber = studentsFound.length;
   
   for (var f=0; f<taskNumber ; f++) {

     var id = "student"+f;
    
     
     $('#user-on-list').clone().appendTo(container).attr('id',id);
     $('#'+id+' .user-name').text(studentsFound[f]);
     $('#'+id+' input').attr({ id:id , value: studentsFound[f] });
     $('#'+id+' label').attr('for',id);
    
     }
     
      $('#user-on-list').hide();
    
     }
     
         
  //creates new student and adds to list
$('#newStudentSubmit').click(function() {  

    $('#newStudentSubmit').prop( "disabled", true );
            
            google.script.run
            .withSuccessHandler(function(response){ $('#page3').hide(1000); confirm(response); studentList(); })
            .processForm(this.parentNode)
            
            });
            
     
 //snackbar confirmation     
      
      function confirm(response) {
      
       'use strict';
  window['counter'] = 0;
  
    var snackbarContainer = document.querySelector('#demo-toast-example');
    var data = {message: response };
    snackbarContainer.MaterialSnackbar.showSnackbar(data);
      }

    </script>



